apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: "dag-to-retry"
spec:
  podMetadata:
    annotations:
      sidecar.istio.io/inject: "false"
  entrypoint: dag
  templates:
    - name: step
      inputs:
        parameters:
          - name: exitCode
      container:
        image: alpine:3.7
        command: [ sh, "-c", "exit {{inputs.parameters.exitCode}}" ]
    - name: dag
      dag:
        failFast: false
        tasks:
          - name: success
            template: step
            arguments:
              parameters:
                - name: exitCode
                  value: 0
          - name: failure
            template: step
            dependencies:
              - success
            arguments:
              parameters:
                - name: exitCode
                  value: 1
          - name: task-after-failure
            template: step
            dependencies:
              - failure
            arguments:
              parameters:
                - name: exitCode
                  value: 0
          - name: continue
            template: step
            continueOn:
              failed: true
            dependencies:
              - success
            arguments:
              parameters:
                - name: exitCode
                  value: 2
          - name: task-after-continue
            template: step
            dependencies:
              - continue
            arguments:
              parameters:
                - name: exitCode
                  value: 0