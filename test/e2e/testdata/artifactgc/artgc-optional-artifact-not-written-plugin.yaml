apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: artgc-optional-artifact-not-written-plugin-
spec:
  entrypoint: entrypoint
  artifactGC:
    strategy: OnWorkflowDeletion
  podGC:
    strategy: ""
  templates:
    - name: entrypoint
      steps:
      - - name: some-artifacts-not-written
          template: some-artifacts-not-written
      - - name: artifact-written
          template: artifact-written
    - name: some-artifacts-not-written
      archiveLocation:
        plugin:
          name: test
          key: "{{workflow.name}}"
          configuration: |
            bucket: plugin-bucket
            endpoint: minio:9000
            insecure: true
            accessKeySecret:
              name: my-minio-cred
              key: accesskey
            secretKeySecret:
              name: my-minio-cred
              key: secretkey
      container:
        image: argoproj/argosay:v2
        command:
          - sh
          - -c
        args:
          - |
            echo "something" > /tmp/present
      outputs:
        artifacts:
          - name: notpresent
            path: /tmp/notpresent
            optional: true
            archive:
              none: {}
          - name: present
            path: /tmp/present
            archive:
              none: {}
    - name: artifact-written
      archiveLocation:
        plugin:
          name: test
          key: "{{workflow.name}}"
          configuration: |
            bucket: plugin-bucket
            endpoint: minio:9000
            insecure: true
            accessKeySecret:
              name: my-minio-cred
              key: accesskey
            secretKeySecret:
              name: my-minio-cred
              key: secretkey
      container:
        image: argoproj/argosay:v2
        command:
          - sh
          - -c
        args:
          - |
            echo "something" > /tmp/present
      outputs:
        artifacts:
          - name: present
            path: /tmp/present
            archive:
              none: {}
