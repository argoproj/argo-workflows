apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: many-large-workflows
spec:
  entrypoint: main
  podGC:
    strategy: OnPodCompletion
  arguments:
    parameters:
      - name: "x"
        value: 1
      - name: "y"
        value: 1
  templates:
    - name: main
      dag:
        tasks:
          - name: create-workflow
            template: create-workflow
            withSequence:
              count: "{{workflow.parameters.x}}"
    - name: create-workflow
      resource:
        action: create
        setOwnerReference: true
        # why `Running` not `Succeeded`, because we can afford to have pods waiting around
        successCondition: status.phase = Running
        failureCondition: status.phase in (Failed, Error)
        manifest: |
          apiVersion: argoproj.io/v1alpha1
          kind: Workflow
          metadata:
            generateName: large-workflow-
          spec:
            entrypoint: main
            podGC:
              strategy: OnPodCompletion
            ttlStrategy:
              secondsAfterCompletion: 60
            templates:
              - name: main
                dag:
                  tasks:
                    - name: create-pod
                      template: create-pod
                      withSequence:
                        count: "{{workflow.parameters.y}}"
              - name: create-pod
                container:
                  image: argoproj/argosay:v2
