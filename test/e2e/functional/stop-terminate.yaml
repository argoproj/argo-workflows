apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: stop-terminate-
spec:
  entrypoint: main
  onExit: exit
  templates:
    - name: main
      dag:
        tasks:
          - name: A
            template: echo
            onExit: exit-template

    - name: echo
      container:
        image: argoproj/argosay:v1
        command:
          - /bin/bash
          - "-c"
          - "-x"
          - |
            date -Is --uc
            sleep 999
            date -Is --uc
            echo bye

    - name: exit
      container:
        image: argoproj/argosay:v1
        command:
          - /bin/bash
          - "-c"
          - "-x"
          - |
            date -Is --uc
            echo bye
   
    # We should sleep finite time to ensure workflow controller wait for DAG onExit template to complete.
    - name: exit-template
      container:
        image: argoproj/argosay:v1
        command:
          - /bin/bash
          - "-c"
          - "-x"
          - |
            date -Is --uc
            sleep 5
            date -Is --uc
            echo bye

