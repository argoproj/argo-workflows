---
type: workflow
version: 1
name: test-secret-management-workflow
description: This is the workflow to test whether secret encrytion works
inputs:
  parameters:
    COMMIT:
      default: "%%session.commit%%"
    REPO:
      default: "%%session.repo%%"
    MYSECRET:
      default: "%%secrets.admin@internal.testme.mysecret%%"
#    MYENV:
#      default: "%%secrets.admin@internal.testme.myenv%%"
#    MYENV2:
#      default: "%%secrets.admin@internal.testme.myenv2%%"
steps:
  - CHECKOUT:
      template: argo-checkout
  - SECRET-MANAGEMENT:
      template: test-secret-management

---
type: container
version: 1
name: test-secret-management
description: Test whether secret in ENV works as expected
image: argobase/alpine:3.5
command: ["sh", "-c"]
args: ["echo %%inputs.parameters.REPO%% && echo %%inputs.parameters.MYSECRET%% && echo $TESTENV && echo $TESTENV2"]
resources:
  mem_mib: 400
  cpu_cores: 0.1
#ENV:
#  - name: TESTENV
#    value: "%%inputs.parameters.MYENV%%"
#  - name: TESTENV2
#    value: "%%inputs.parameters.MYENV2%%"
inputs:
  parameters:
    REPO:
    MYSECRET:
#    MYENV:
#    MYENV2: