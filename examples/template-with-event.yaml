# Workflow templates can be triggered by an event.
# Example:
# curl -d '{"message": "hello"}' https://localhost:2746/api/v1/events/argo -k -H "Authorization: Bearer $ARGO_TOKEN"
metadata:
  name: event-triggered
spec:
  event:
    expression: metadata.claimSet.sub == "admin" && event.message != ""
  entrypoint: main
  arguments:
    parameters:
      - name: message
        valueFrom:
          expression: event.message
  templates:
    - name: main
      steps:
        - - name: step-1
            template: argosay
            arguments:
              parameters:
                - name: message
                  value: "{{workflow.parameters.message}}"

    - name: argosay
      inputs:
        parameters:
          - name: message
      container:
        image: argoproj/argosay:v2
        args: [echo, "{{inputs.parameters.message}}"]