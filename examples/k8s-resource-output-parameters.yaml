apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: k8s-resource-output-params-
  labels:
    workflows.argoproj.io/test: "true"
  annotations:
    workflows.argoproj.io/description: |
      This example submits a k8s pod as resource template
      and illustrates the use of `jsonPath` and `jqFilter`
      in its output parameters.
    workflows.argoproj.io/verify.py: |
      assert status["phase"] == "Succeeded"
spec:
  entrypoint: pi-tmpl
  templates:
  - name: pi-tmpl
    resource:
      action: create
      successCondition: status.phase == Succeeded
      failureCondition: status.phase == Failed
      manifest: |
        apiVersion: v1
        kind: Pod
        metadata:
          generateName: pi-pod-
        spec:
            containers:
            - name: pi
              image: perl
              command: ["perl",  "-Mbignum=bpi", "-wle", "print bpi(2000)"]
            restartPolicy: Never
    # Resource templates can have output parameters extracted from fields of the
    # resource. Two techniques are provided: jsonpath and a jq filter.
    outputs:
      parameters:
      # pod-name is extracted using a jsonPath expression and is equivalent to:
      # `kubectl get pod <podname> -o jsonpath='{.metadata.name}'`
      - name: pod-name
        valueFrom:
          jsonPath: '{.metadata.name}'
      # pod-obj is extracted using a jq filter and is equivalent to:
      # `kubectl get pod <podname> -o json | jq -rc '.'
      # which returns the entire pod object in json format
      - name: pod-obj
        valueFrom:
          jqFilter: '.'
