version: "2"
linters:
  enable:
    - asciicheck
    - asasalint
    - bidichk
    - bodyclose
    - copyloopvar
    - contextcheck
    - containedctx
    - durationcheck
    - errcheck
    - errorlint
    - exptostd
    - gocheckcompilerdirectives
    - gocritic
    - gosec
    - govet
    - iface
    - ineffassign
    - iotamixing
    - mirror
    - misspell
    - modernize
    - nakedret
    - nilerr
    - noctx
    - nosprintfhostport
    - nolintlint
    - predeclared
    - reassign
    - revive
    - rowserrcheck
    - sqlclosecheck
    - staticcheck
    - testifylint
    - unconvert
    - unparam
    - unused
    - usestdlibvars
    - usetesting
    - wastedassign
    - whitespace
  settings:
    revive:
      rules:
        # defaults
        - name: blank-imports
        - name: context-as-argument
        - name: context-keys-type
        - name: dot-imports
        - name: empty-block
        - name: error-naming
        - name: error-return
        - name: error-strings
        - name: errorf
        - name: exported
        - name: increment-decrement
        - name: indent-error-flow
        - name: package-comments
        - name: range
        - name: receiver-naming
        - name: redefines-builtin-id
        - name: superfluous-else
        - name: time-naming
        - name: unexported-return
        - name: unreachable-code
        - name: var-declaration
        # disabled defaults due to large number of fixes required for now - PRs welcome
        - name: unused-parameter
          disabled: true
        - name: var-naming
          disabled: true
        # additional rules
        - name: atomic
        - name: datarace
        - name: defer
        - name: duplicated-imports
        - name: early-return
        - name: forbidden-call-in-wg-go
        - name: identical-branches
        - name: identical-ifelseif-branches
        - name: identical-ifelseif-conditions
        - name: identical-switch-branches
        - name: identical-switch-conditions
        - name: modifies-value-receiver
        - name: optimize-operands-order
        - name: package-directory-mismatch
        - name: time-equal
        - name: unnecessary-if
        - name: unnecessary-stmt
        - name: use-waitgroup-go
        - name: useless-break
        - name: useless-fallthrough
    gosec:
      includes:
        - G304
        - G307
      excludes:
        # G106: Use of ssh InsecureIgnoreHostKey should be audited
        - G106
        # G402: TLS InsecureSkipVerify set true
        - G402
    staticcheck:
      checks:
        - all
    govet:
      enable:
        # Check for missing values after append.
        - appends
        # Report mismatches between assembly files and Go declarations.
        - asmdecl
        # Check for useless assignments.
        - assign
        # Check for common mistakes using the sync/atomic package.
        - atomic
        # Check for non-64-bits-aligned arguments to sync/atomic functions.
        - atomicalign
        # Check for common mistakes involving boolean operators.
        - bools
        # Check //go:build and // +build directives.
        - buildtag
        # Detect some violations of the cgo pointer passing rules.
        - cgocall
        # Check for unkeyed composite literals.
        - composites
        # Check for locks erroneously passed by value.
        - copylocks
        # Check for calls of reflect.DeepEqual on error values.
        - deepequalerrors
        # Report common mistakes in defer statements.
        - defers
        # Check Go toolchain directives such as //go:debug.
        - directive
        # Report passing non-pointer or non-error values to errors.As.
        - errorsas
        # Find structs that would use less memory if their fields were sorted.
        # Not enabled as autofix removes all comments and we like comments.
        # - fieldalignment
        # Find calls to a particular function.
        - findcall
        # Report assembly that clobbers the frame pointer before saving it.
        - framepointer
        # Check format of addresses passed to net.Dial.
        - hostport
        # Report using Go 1.22 enhanced ServeMux patterns in older Go versions.
        - httpmux
        # Check for mistakes using HTTP responses.
        - httpresponse
        # Detect impossible interface-to-interface type assertions.
        - ifaceassert
        # Check references to loop variables from within nested functions.
        - loopclosure
        # Check cancel func returned by context.WithCancel is called.
        - lostcancel
        # Check for useless comparisons between functions and nil.
        - nilfunc
        # Check for redundant or impossible nil comparisons.
        - nilness
        # Check consistency of Printf format strings and arguments.
        - printf
        # Check for comparing reflect.Value values with == or reflect.DeepEqual.
        - reflectvaluecompare
        # Check for possible unintended shadowing of variables.
        - shadow
        # Check for shifts that equal or exceed the width of the integer.
        - shift
        # Check for unbuffered channel of os.Signal.
        - sigchanyzer
        # Check for invalid structured logging calls.
        - slog
        # Check the argument type of sort.Slice.
        - sortslice
        # Check signature of methods of well-known interfaces.
        - stdmethods
        # Report uses of too-new standard library symbols.
        - stdversion
        # Check for string(int) conversions.
        - stringintconv
        # Check that struct field tags conform to reflect.StructTag.Get.
        - structtag
        # Report calls to (*testing.T).Fatal from goroutines started by a test.
        - testinggoroutine
        # Check for common mistaken usages of tests and examples.
        - tests
        # Check for calls of (time.Time).Format or time.Parse with 2006-02-01.
        - timeformat
        # Report passing non-pointer or non-interface values to unmarshal.
        - unmarshal
        # Check for unreachable code.
        - unreachable
        # Check for invalid conversions of uintptr to unsafe.Pointer.
        - unsafeptr
        # Check for unused results of calls to some functions.
        - unusedresult
        # Checks for unused writes.
        - unusedwrite
        # Check for misuses of sync.WaitGroup.
        - waitgroup
  exclusions:
    generated: lax
    presets:
      - std-error-handling
    rules:
      # Selectively suppress revive comment rules (large fix count â€” PRs welcome)
      - linters: [revive]
        text: "exported (.+) should have comment( \\(or a comment on this block\\))? or be unexported"
      - linters: [revive]
        text: "package comment should be of the form \"(.+)\\.\\.\\.\""
      - linters: [revive]
        text: "comment on exported (.+) should be of the form \"(.+)\\.\\.\\.\""
      - linters: [revive]
        text: "should have a package comment"
      # Suppress ST1000 (package-level doc comments) for now
      - linters: [staticcheck]
        text: "ST1000:"
      - linters: [gosec]
        text: "G304:"
      - path: server/artifacts/artifact_server_test.go
        text: response body must be closed
      - path: server/apiserver/argoserver.go
        # The nolintlint fixer erroneous removes the nolint directives in this file
        linters:
          - contextcheck
    paths:
      - dist
      - docs
      - examples
      - hack
      - manifests
      - pkg/client
      - sdks
      - ui
      - vendor
      - third_party$
      - builtin$
      - examples$
formatters:
  enable:
    - gofmt
    - goimports
  settings:
    goimports:
      local-prefixes:
        - github.com/argoproj/argo-workflows/
  exclusions:
    generated: lax
    paths:
      - dist
      - docs
      - examples
      - hack
      - manifests
      - pkg/client
      - sdks
      - ui
      - vendor
      - third_party$
      - builtin$
      - examples$
issues:
  max-issues-per-linter: 0  # 0 means unlimited
  max-same-issues: 0
