# Test to ensure parameter aggregation works when every item is filtered
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: ui-parameter-aggregation-empty-
spec:
  entrypoint: parameter-aggregation
  templates:
  - name: parameter-aggregation
    steps:
    - - name: generate
        template: echo
        arguments:
          parameters:
          - name: message
            value: "{{item}}"
        withItems: [1, 2, 3, 4]
        when: "{{item}} == foo"

    - - name: consume
        template: echo
        arguments:
          parameters:
          - name: message
            value: "{{item}}"
        withParam: "{{steps.generate.outputs.result}}"

    - - name: done
        template: echo
        arguments:
          parameters:
          - name: message
            value: done

  # echo prints a message
  - name: echo
    inputs:
      parameters:
      - name: message
    script:
      image: argoproj/argosay:v1
      command: [sh, -x]
      source: |
        #!/bin/sh
        echo {{inputs.parameters.message}}
